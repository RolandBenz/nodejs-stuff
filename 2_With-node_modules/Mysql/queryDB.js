var mysql = require('mysql');
//https://alvarotrigo.com/blog/wait-1-second-javascript/
//https://learnsql.com/cookbook/how-to-create-a-table-with-a-foreign-key-in-sql/ 
function delay(milliseconds){
    return new Promise(resolve => {
        setTimeout(resolve, milliseconds);
    });
}
async function run(){
    console.log("Executed now");
    /*create connection to db server and db mydb*/
    var con = mysql.createConnection({
        host: "localhost",
        user: "RolandBenz",
        password: "Qqr***",
        database: "mydb"
    });
    /*connect to db server and db mydb and query table and columns*/
    con.connect(function(err) {
        if (err) throw err;
        con.query("SELECT name, address FROM customers", function (err, result, fields) {
            if (err) throw err;
            console.log(result);
            console.log(fields);
            /*end connetion to db*/
            con.end(function(err) {
                if (err) {
                return console.log('error:' + err.message);
                }
                console.log('Close the database connection.');
                /*destroy connetion to db server*/
                con.destroy();
            });
        });
    });
    await delay(1000);
    console.log("Executed after 1 seconds wait");
    /*create connection to db server and db mydb*/
    var con1 = mysql.createConnection({
        host: "localhost",
        user: "RolandBenz",
        password: "Qqr***",
        database: "mydb"
    });
    /*connect to db server and db mydb and query table with filter; S+wildcard; start with S followed by whatever*/
    con1.connect(function(err) {
        if (err) throw err;
        con1.query("SELECT * FROM customers WHERE address LIKE 'S%'", function (err, result) {
            if (err) throw err;
            console.log(result);
            /*end connetion to db*/
            con1.end(function(err) {
                if (err) {
                return console.log('error:' + err.message);
                }
                console.log('Close the database connection.');
                /*destroy connetion to db server*/
                con1.destroy();
            });
        });
    });
    await delay(1000);
    console.log("Executed after 2 seconds wait");
    /*create connection to db server and db mydb*/
    var con2 = mysql.createConnection({
        host: "localhost",
        user: "RolandBenz",
        password: "Qqr***",
        database: "mydb"
    });
    /*connect to db server and db mydb and query table with simulated user data; escaped to prevent sql injection*/
    con2.connect(function(err) {
        var adr = 'Canyon 123';
        var sql = 'SELECT * FROM customers WHERE address = ' + mysql.escape(adr);
        con2.query(sql, function (err, result) {
            if (err) throw err;
            console.log(result);
            /*end connetion to db*/
            con2.end(function(err) {
                if (err) {
                return console.log('error:' + err.message);
                }
                console.log('Close the database connection.');
                /*destroy connetion to db server*/
                con2.destroy();
            });
        });
    });
    await delay(1000);
    console.log("Executed after 3 seconds wait");
    /*create connection to db server and db mydb*/
    var con3 = mysql.createConnection({
        host: "localhost",
        user: "RolandBenz",
        password: "Qqr***",
        database: "mydb"
    });
    /*connect to db server and db mydb and query table with placeholder ? for values to escape*/
    con3.connect(function(err) {
        var name = 'Amy';
        var adr = 'Mountain 21';
        var sql = 'SELECT * FROM customers WHERE name = ? OR address = ?';
        con3.query(sql, [name, adr], function (err, result) {
            if (err) throw err;
            console.log(result);
            /*end connetion to db*/
            con3.end(function(err) {
                if (err) {
                return console.log('error:' + err.message);
                }
                console.log('Close the database connection.');
                /*destroy connetion to db server*/
                con3.destroy();
            });
        });
    });
    await delay(1000);
    console.log("Executed after 4 seconds wait");
    /*create connection to db server and db mydb*/
    var con4 = mysql.createConnection({
        host: "localhost",
        user: "RolandBenz",
        password: "Qqr***",
        database: "mydb"
    });
    /*connect to db server and db mydb and query table and limit nr of records to 5, starting at pos 3*/
    con4.connect(function(err) {
        if (err) throw err;
        var sql = "SELECT * FROM customers LIMIT 5 OFFSET 2";
        con4.query(sql, function (err, result) {
            if (err) throw err;
            console.log(result);
            /*end connetion to db*/
            con4.end(function(err) {
                if (err) {
                return console.log('error:' + err.message);
                }
                console.log('Close the database connection.');
                /*destroy connetion to db server*/
                con4.destroy();
            });
        });
    });
}
run();
