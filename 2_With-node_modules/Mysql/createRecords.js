var mysql = require('mysql');
//https://alvarotrigo.com/blog/wait-1-second-javascript/
//https://learnsql.com/cookbook/how-to-create-a-table-with-a-foreign-key-in-sql/ 
function delay(milliseconds){
    return new Promise(resolve => {
        setTimeout(resolve, milliseconds);
    });
}
async function run(){
    console.log("Executed now");
    /*create connection to db server and db mydb*/
    var con = mysql.createConnection({
        host: "localhost",
        user: "RolandBenz",
        password: "Qqr***",
        database: "mydb"
    });
    /*connect to db server and db mydb and insert records*/
    con.connect(function(err) {
        if (err) throw err;
        console.log("Connected!");
        var sql = "INSERT INTO customers (name, address) VALUES ?";
        var values = [
            ['John', 'Highway 71'],
            ['Peter', 'Lowstreet 4'],
            ['Amy', 'Apple st 652'],
            ['Hannah', 'Mountain 21'],
            ['Michael', 'Valley 345'],
            ['Sandy', 'Ocean blvd 2'],
            ['Betty', 'Green Grass 1'],
            ['Richard', 'Sky st 331'],
            ['Susan', 'One way 98'],
            ['Vicky', 'Yellow Garden 2'],
            ['Ben', 'Park Lane 38'],
            ['William', 'Central st 954'],
            ['Chuck', 'Main Road 989'],
            ['Viola', 'Sideway 1633']
        ];
        con.query(sql, [values], function (err, result) {
            if (err) throw err;
            console.log("Number of records inserted: " + result.affectedRows);
            /*end connetion to db*/
            con.end(function(err) {
                if (err) {
                return console.log('error:' + err.message);
                }
                console.log('Close the database connection.');
                /*destroy connetion to db server*/
                con.destroy();
            });
        });
    });
    await delay(1000);
    console.log("Executed after 1 seconds wait");
    /*create connection to db server and db mydb*/
    var con1 = mysql.createConnection({
        host: "localhost",
        user: "RolandBenz",
        password: "Qqr***",
        database: "mydb"
    });
    /*connect to db server and db mydb and add one more record*/
    con1.connect(function(err) {
        if (err) throw err;
        var sql = "INSERT INTO customers (name, address) VALUES ('Michelle', 'Blue Village 1')";
        con1.query(sql, function (err, result) {
            if (err) throw err;
            console.log("1 record inserted, ID: " + result.insertId);
            /*end connetion to db*/
            con1.end(function(err) {
                if (err) {
                return console.log('error:' + err.message);
                }
                console.log('Close the database connection.');
                /*destroy connetion to db server*/
                con1.destroy();
            });
        });
    });
    await delay(1000);
    console.log("Executed after 2 seconds wait");
    /*create connection to db server and db mydb*/
    var con2 = mysql.createConnection({
        host: "localhost",
        user: "RolandBenz",
        password: "Qqr***",
        database: "mydb"
    });

    /*connect to db server and db mydb and update a record*/
    con2.connect(function(err) {
        if (err) throw err;
        var sql = "UPDATE customers SET address = 'Canyon 123' WHERE address = 'Valley 345'";
        con2.query(sql, function (err, result) {
            if (err) throw err;
            console.log(result.affectedRows + " record(s) updated");
            /*end connetion to db*/
            con2.end(function(err) {
                if (err) {
                return console.log('error:' + err.message);
                }
                console.log('Close the database connection.');
                /*destroy connetion to db server*/
                con2.destroy();
            });
        });
    });
    await delay(1000);
    console.log("Executed after 3 seconds wait");
    /*create connection to db server and db mydb*/
    var con3 = mysql.createConnection({
        host: "localhost",
        user: "RolandBenz",
        password: "Qqr***",
        database: "mydb"
    });
    /*connect to db server and db mydb and delete a record*/
    con3.connect(function(err) {
        if (err) throw err;
        var sql = "DELETE FROM customers WHERE address = 'Mountain 21'";
        con3.query(sql, function (err, result) {
            if (err) throw err;
            console.log("Number of records deleted: " + result.affectedRows);
            /*end connetion to db*/
            con3.end(function(err) {
                if (err) {
                return console.log('error:' + err.message);
                }
                console.log('Close the database connection.');
                /*destroy connetion to db server*/
                con3.destroy();
            });
        });
    });
    await delay(1000);
    console.log("Executed after 4 seconds wait");
    /*create connection to db server and db mydb*/
    var con5 = mysql.createConnection({
        host: "localhost",
        user: "RolandBenz",
        password: "Qqr***",
        database: "mydb"
    });
    /*connect to db server and db mydb and insert records*/
    con5.connect(function(err) {
        if (err) throw err;
        console.log("Connected!");
        var sql = "INSERT INTO products (id, name) VALUES ?";
        var values = [
            [154, 'Chocolate Heaven'],
            [155, 'Tasty Lemons'],
            [156, 'Vanilla Dreams']
        ];
        con5.query(sql, [values], function (err, result) {
            if (err) throw err;
            console.log("Number of records inserted: " + result.affectedRows);
            /*end connetion to db*/
            con5.end(function(err) {
                if (err) {
                return console.log('error:' + err.message);
                }
                console.log('Close the database connection.');
                /*destroy connetion to db server*/
                con5.destroy();
            });
        });
    });
    await delay(1000);
    console.log("Executed after 5 seconds wait");
    /*create connection to db server and db mydb*/
    var con4 = mysql.createConnection({
        host: "localhost",
        user: "RolandBenz",
        password: "Qqr***",
        database: "mydb"
    });
    /*connect to db server and db mydb and insert records*/
    con4.connect(function(err) {
        if (err) throw err;
        console.log("Connected!");
        var sql = "INSERT INTO users (name, favorite_product) VALUES ?";
        var values = [
            ['John', 154],
            ['Peter', 154],
            ['Amy', 155],
            ['Hannah', null],
            ['Michael', null]
        ];
        con4.query(sql, [values], function (err, result) {
            if (err) throw err;
            console.log("Number of records inserted: " + result.affectedRows);
            /*end connetion to db*/
            con4.end(function(err) {
                if (err) {
                return console.log('error:' + err.message);
                }
                console.log('Close the database connection.');
                /*destroy connetion to db server*/
                con4.destroy();
            });
        });
    });
}
run();
