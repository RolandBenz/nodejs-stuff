/*
https://www.geeksforgeeks.org/how-to-fetch-images-from-node-js-server/ 
Try out:
	1. Run Servers in Node Terminal
		1.1 ShowImg> node .\appServer1.js
	2. Request image in Browser
		2.1 URL http://localhost:3000/images/lights.jpg
*/

// Requiring modules
const http = require("http");
const fs = require("fs");
const path = require("path");
const url = require("url");
// Creating server to accept request
http.createServer((req, res) => {
    // Parsing the URL
    var request = url.parse(req.url, true);
    // Extracting the path of requested file within URL
    var action = request.pathname;
    // Path Refinements, add directory of appServer1.js and replace %20 with space
    var filePath = path.join(__dirname, action).split("%20").join(" ");
    // Checking if the path exists
		// depreciated method fs.exist() replaced with fs.access()
		// https://stackoverflow.com/questions/63984035/node-file-system-fs-exist-strikethrough
    fs.access(filePath, (exists) => {
      if (!exists) {
        res.writeHead(404, {
          "Content-Type": "text/plain",
        });
        res.end("404 Not Found, Computer says!");
        return;
      }
      // Extracting file extension
      var ext = path.extname(action);
      // Setting default Content-Type
      var contentType = "text/plain";
      // Checking if the extension of
      // image is '.png'
      if (ext === ".png") {
        contentType = "image/png";
      } else if (ext === ".jpg") {
        contentType = "image/jpg";
      }
      // Setting the headers
      res.writeHead(200, {
        "Content-Type": contentType,
      });
      // Reading the requested file
      fs.readFile(filePath, function (err, content) {
        // Serving the image
        res.end(content);
      });
    });
  })
  // Listening to the PORT: 3000
  .listen(3000, "127.0.0.1");
